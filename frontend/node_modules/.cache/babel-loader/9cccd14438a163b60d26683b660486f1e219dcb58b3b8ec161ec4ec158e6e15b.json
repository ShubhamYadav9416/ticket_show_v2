{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport UserHeader from '@/components/UserHeader.vue';\nimport axios from 'axios';\nimport refreshAccessToken from '../../../utils/refreshToken';\nexport default {\n  name: 'MovieBooking',\n  data() {\n    return {\n      theater_movie_id: this.$route.params.id,\n      no_of_tickets: \"\",\n      movie_data: [],\n      price: \"\",\n      cost_per_ticket: \"\",\n      booking_close: false\n    };\n  },\n  created() {\n    this.movieDataBooking();\n  },\n  methods: {\n    minus() {\n      if (this.no_of_tickets === 0) {\n        this.no_of_tickets = 0;\n        this.price = \"\";\n      } else if (this.no_of_tickets < 0) {\n        this.booking_close = true;\n      } else {\n        this.no_of_tickets = this.no_of_tickets - 1;\n        this.price = this.no_of_tickets * this.cost_per_ticket;\n      }\n    },\n    plus() {\n      if (!this.no_of_tickets) {\n        this.no_of_tickets = 1;\n        this.price = this.no_of_tickets * this.cost_per_ticket;\n      } else {\n        let max_ticket = this.movie_data.seat_left;\n        if (max_ticket == 0) {\n          this.booking_close = true;\n        } else if (max_ticket > 9) {\n          if (this.no_of_tickets > 8) {\n            this.no_of_tickets = 9;\n            this.price = this.no_of_tickets * this.cost_per_ticket;\n          } else {\n            this.no_of_tickets = this.no_of_tickets + 1;\n            this.price = this.no_of_tickets * this.cost_per_ticket;\n          }\n        } else {\n          if (this.no_of_tickets > max_ticket - 1) {\n            this.no_of_tickets = max_ticket;\n            this.price = this.no_of_tickets * this.cost_per_ticket;\n          } else {\n            this.no_of_tickets = this.no_of_tickets + 1;\n            this.price = this.no_of_tickets * this.cost_per_ticket;\n          }\n        }\n        // if (this.movie_data.seat_left > 9){\n        //     this.no_of_tickets = this.no_of_tickets + 1\n        //     this.price = this.no_of_tickets * this.cost_per_ticket\n        // }\n        // else if (this.movie_data.seat_left < 10){\n        //     this.no_of_tickets = this.movie_data.seat_left\n        //     this.price = this.no_of_tickets * this.cost_per_ticket\n        // }\n      }\n    },\n\n    async movieDataBooking() {\n      try {\n        let access_token = localStorage.getItem('access_token');\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token;\n        const theatersMoviebookingResponse = await axios.get(`http://127.0.0.1:8081/api/theater_movie/booking/${this.theater_movie_id}`);\n        this.movie_data = theatersMoviebookingResponse.data[0];\n        this.cost_per_ticket = this.movie_data.current_price;\n      } catch (error) {\n        if (error.response && error.response.status === 401) {\n          await refreshAccessToken();\n          await this.movieDataBooking();\n        } else if (error.response) {\n          console.error(error);\n          alert('An error occurred while fetching the movie data.');\n        }\n      }\n    },\n    async bookTicket() {\n      if (!this.no_of_tickets) {\n        alert(\"Add Number of Ticekt !!\");\n        return;\n      } else if (this.no_of_tickets > 0 || this.no_of_tickets < 10) {\n        alert(\"no. of ticket can't be less than 0 and greater than 9\");\n        return;\n      }\n      try {\n        let formData = new FormData();\n        formData.append('data', JSON.stringify({\n          no_of_tickets: this.no_of_tickets,\n          total_paid: this.price\n        }));\n        let access_token = localStorage.getItem('access_token');\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token;\n        console.log(typeof this.no_of_tickets);\n        await axios.post(`http://127.0.0.1:8081//api/book_ticket/${this.theater_movie_id}`, formData);\n        this.$router.push(\"/bookings\");\n      } catch (error) {\n        if (error.response && error.response.status === 401) {\n          await refreshAccessToken();\n          await this.bookTicket();\n        } else if (error.response && error.response.status === 400 || error.response.status === 422) {\n          this.errors = error.response.data.errors;\n          alert('An error occurred while ticket booking.');\n        }\n      }\n    }\n  },\n  components: {\n    'user-header': UserHeader\n  }\n};","map":{"version":3,"names":["UserHeader","axios","refreshAccessToken","name","data","theater_movie_id","$route","params","id","no_of_tickets","movie_data","price","cost_per_ticket","booking_close","created","movieDataBooking","methods","minus","plus","max_ticket","seat_left","access_token","localStorage","getItem","defaults","headers","common","theatersMoviebookingResponse","get","current_price","error","response","status","console","alert","bookTicket","formData","FormData","append","JSON","stringify","total_paid","log","post","$router","push","errors","components"],"sources":["src/views/user/ticket_booking/MovieBooking.vue"],"sourcesContent":["<template>\n    <div>\n        <user-header></user-header>\n        <div class=\"container text-center\">\n            <div class=\"row\" id=\"outer\">\n                <div class=\"col-2\">\n\n                </div>\n                <div class=\"col\">\n                    <div class=\"container text-center\">\n                        <div class=\"row\" style=\"padding: 10px;\" id=\"inner\">\n                            <div class=\"col-7\" align=\"left\">\n                                <h5>{{ movie_data.movie_name }}</h5>\n                                <p style=\"font-size: small; color: rgb(71, 69, 69);\">{{ movie_data.movie_tag }} | {{\n                                    movie_data.movie_language }} | {{ movie_data.movie_duration }}</p>\n                                <p style=\"font-weight: 300;\">{{ movie_data.movie_description }}</p>\n                                <p class=\"location\"><i class=\"bi bi-geo-alt-fill\" style=\"color:green\"></i>{{\n                                    movie_data.theater_place }} , {{ movie_data.theater_location }}\n                                </p>\n                                <span style=\"font-size: small;\">Per Ticket Rs<i style=\"font-size: medium;\">{{\n                                    movie_data.current_price }}<i class=\"bi bi-arrow-down-right\" style=\"color:green;\" v-show=\"movie_data.current_price < movie_data.start_price\"></i><i class=\"bi bi-arrow-up-left\" style=\"color:red;\" v-show=\"movie_data.current_price > movie_data.start_price\"></i> </i></span>\n                                <div class=\"d-flex align-items-end\" v-show=\"!booking_close\">\n                                    <button class=\"minus_button\" @click=\"minus()\">-</button>\n                                    <input style=\"width: 50px; height: 40px;\" v-model=\"no_of_tickets\">\n                                    <button class=\"plus_button\" @click=\"plus()\">+</button>\n                                    <p v-show=\"price\">Pay Rs {{ price }}.00</p>\n                                    <button type=\"button\" class=\"btn btn-success\" style=\"margin-left: 20px;\"\n                                        v-show=\"no_of_tickets > 0\"  @click=\"bookTicket()\">Book</button>\n                                </div>\n                                <span style=\"font-size: small;\">Hurry up!! only <i style=\"font-size: medium;\">{{\n                                    movie_data.seat_left }}</i>\n                                    left.</span>\n                            </div>\n                            <div class=\"col-1\"></div>\n                            <div class=\"col-4\">\n                                <img :src=\"`data:image/jpeg;base64,${movie_data.poster_url}`\" class=\"rounded mx-auto d-block\" alt=\"...\" style=\"max-height: 350px; max-width: 175px;\">\n                            </div>\n\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-2 d-flex align-items-start\">\n                    <router-link to=\"/home\">\n                        <button type=\"button\" class=\"btn-close\" aria-label=\"Close\"\n                            style=\"margin-left: -20px;margin-top: -10px;\"></button>\n                    </router-link>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport UserHeader from '@/components/UserHeader.vue';\nimport axios from 'axios';\n\nimport refreshAccessToken from '../../../utils/refreshToken'\n\n\n\nexport default {\n    name: 'MovieBooking',\n    data() {\n        return {\n            theater_movie_id: this.$route.params.id,\n            no_of_tickets: \"\",\n            movie_data: [],\n            price: \"\",\n            cost_per_ticket: \"\",\n            booking_close:false,\n        }\n    },\n    created() {\n        this.movieDataBooking()\n    },\n    methods: {\n        minus() {\n            if (this.no_of_tickets === 0) {\n                this.no_of_tickets = 0\n                this.price = \"\"\n            }\n            else if (this.no_of_tickets < 0) {\n                this.booking_close = true\n            }\n            else {\n                this.no_of_tickets = this.no_of_tickets - 1\n                this.price = this.no_of_tickets * this.cost_per_ticket\n            }\n        },\n        plus() {\n            if (!this.no_of_tickets) {\n                this.no_of_tickets = 1\n                this.price = this.no_of_tickets * this.cost_per_ticket\n            }\n            else {\n                let max_ticket = this.movie_data.seat_left\n                if (max_ticket == 0){\n                    this.booking_close = true\n                }\n                else if (max_ticket > 9){\n                    if (this.no_of_tickets > 8){\n                    this.no_of_tickets = 9\n                    this.price = this.no_of_tickets * this.cost_per_ticket\n                    }\n                    else{\n                    this.no_of_tickets = this.no_of_tickets + 1\n                    this.price = this.no_of_tickets * this.cost_per_ticket\n                    }\n                }\n                else{\n                    if (this.no_of_tickets > max_ticket-1){\n                    this.no_of_tickets = max_ticket\n                    this.price = this.no_of_tickets * this.cost_per_ticket\n                    }\n                    else{\n                    this.no_of_tickets = this.no_of_tickets + 1\n                    this.price = this.no_of_tickets * this.cost_per_ticket\n                    }\n                }\n                // if (this.movie_data.seat_left > 9){\n                //     this.no_of_tickets = this.no_of_tickets + 1\n                //     this.price = this.no_of_tickets * this.cost_per_ticket\n                // }\n                // else if (this.movie_data.seat_left < 10){\n                //     this.no_of_tickets = this.movie_data.seat_left\n                //     this.price = this.no_of_tickets * this.cost_per_ticket\n                // }\n            }\n        },\n        async movieDataBooking() {\n            try {\n                let access_token = localStorage.getItem('access_token')\n\n                axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token\n                const theatersMoviebookingResponse = await axios.get(`http://127.0.0.1:8081/api/theater_movie/booking/${this.theater_movie_id}`)\n                this.movie_data = theatersMoviebookingResponse.data[0]\n                this.cost_per_ticket = this.movie_data.current_price\n            }\n            catch (error) {\n                if (error.response && error.response.status === 401) {\n                    await refreshAccessToken()\n                    await this.movieDataBooking()\n                }\n\n                else if (error.response) {\n                    console.error(error)\n                    alert('An error occurred while fetching the movie data.')\n                }\n            }\n        },\n        async bookTicket(){\n            if (!this.no_of_tickets) {\n                alert(\"Add Number of Ticekt !!\");\n                return;\n            }\n            else if (this.no_of_tickets > 0 || this.no_of_tickets < 10){\n                alert(\"no. of ticket can't be less than 0 and greater than 9\");\n                return;\n            }\n            try {\n\n                let formData = new FormData()\n\n                formData.append('data',JSON.stringify({\n                    no_of_tickets : this.no_of_tickets,\n                    total_paid : this.price\n                }))\n                let access_token = localStorage.getItem('access_token')\n\n                axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token\n                console.log(typeof this.no_of_tickets)\n                await axios.post(`http://127.0.0.1:8081//api/book_ticket/${this.theater_movie_id}`, formData)\n                this.$router.push(\"/bookings\");\n            }\n            catch (error) {\n                if (error.response && error.response.status === 401) {\n                    await refreshAccessToken();\n                    await this.bookTicket();\n                }\n\n                else if (error.response && error.response.status === 400 || error.response.status === 422) {\n                    this.errors = error.response.data.errors;\n                    alert('An error occurred while ticket booking.')\n                }\n            }\n        }\n    },\n    components: {\n        'user-header': UserHeader,\n    },\n\n}\n\n\n</script>\n\n\n<style scoped>\n#outer {\n    margin-top: 90px;\n}\n\n#inner {\n    border: 1px solid rgb(86, 85, 87);\n    border-radius: 5px;\n}\n\n\n\n.minus_button {\n    width: 50px;\n    height: 40px;\n    border-radius: 10px 0px 0 10px;\n    font-size: 20px;\n    font-weight: bolder;\n    background-color: brown;\n}\n\n.plus_button {\n    width: 50px;\n    height: 40px;\n    padding: 0;\n    border-radius: 0px 10px 10px 0px;\n    font-size: 20px;\n    font-weight: bolder;\n    background-color: darkgreen;\n\n}</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}