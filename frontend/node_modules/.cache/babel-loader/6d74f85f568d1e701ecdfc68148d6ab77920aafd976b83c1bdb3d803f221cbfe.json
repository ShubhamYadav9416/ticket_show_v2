{"ast":null,"code":"import axios from 'axios';\nimport refreshAccessToken from '@/utils/refreshToken';\nexport default {\n  name: 'TheaterHome',\n  props: ['theater'],\n  data() {\n    return {\n      show_rate_form: false,\n      rate: \"\",\n      user_rating: \"\",\n      votes: \"\",\n      theater_cal_rating: \"\"\n    };\n  },\n  created() {\n    this.theateruserRatings(), this.theaterRatings();\n  },\n  methods: {\n    async theateruserRatings() {\n      try {\n        let access_token = localStorage.getItem('access_token');\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token;\n        const theatersRatingResponse = await axios.get(`http://127.0.0.1:8081/api/user/rating/theater/${this.theater.theater_id}`);\n        console.log(theatersRatingResponse);\n        if (theatersRatingResponse.data.status === \"not_rated\") {\n          this.show_rate_form = true;\n        } else {\n          this.user_rating = theatersRatingResponse.data.rating;\n          this.show_rate_form = false;\n        }\n      } catch (error) {\n        if (error.response && error.response.status === 401) {\n          await refreshAccessToken();\n          await this.theateruserRatings();\n        } else if (error.response) {\n          console.error(error);\n          alert('An error occurred while fetching the theater user rating data.');\n        }\n      }\n    },\n    async rateTheater() {\n      if (!this.rate || this.rate > 6 || this.rate < 1) {\n        alert(\"Rate theater between 1 to 5 !!\");\n        return;\n      }\n      try {\n        let access_token = localStorage.getItem('access_token');\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token;\n        await axios.post(`http://127.0.0.1:8081/api/user/rating/theater/${this.theater.theater_id}`, {\n          rating: this.rate\n        });\n        this.theateruserRatings();\n        this.theaterRatings();\n      } catch (error) {\n        if (error.response && error.response.status === 401) {\n          await refreshAccessToken();\n          await this.rateTheater();\n        } else if (error.response && error.response.status === 400 || error.response.status === 422) {\n          this.errors = error.response.data.errors;\n          alert('An error occurred while creating theater.');\n        }\n      }\n    },\n    async theaterRatings() {\n      try {\n        let access_token = localStorage.getItem('access_token');\n        axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token;\n        const theatersRatingResponse = await axios.get(`http://127.0.0.1:8081/api/rating/theater/${this.theater.theater_id}`);\n        if (theatersRatingResponse.data.votes === 0) {\n          this.votes = \"-\";\n          this.theater_cal_rating = \"-\";\n        } else {\n          this.theater_cal_rating = theatersRatingResponse.data.total_rating / theatersRatingResponse.data.votes;\n          this.votes = theatersRatingResponse.data.votes;\n        }\n      } catch (error) {\n        if (error.response && error.response.status === 401) {\n          await refreshAccessToken();\n          await this.theaterRatings();\n        } else if (error.response) {\n          console.error(error);\n          alert('An error occurred while fetching the theater user rating data.');\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","refreshAccessToken","name","props","data","show_rate_form","rate","user_rating","votes","theater_cal_rating","created","theateruserRatings","theaterRatings","methods","access_token","localStorage","getItem","defaults","headers","common","theatersRatingResponse","get","theater","theater_id","console","log","status","rating","error","response","alert","rateTheater","post","errors","total_rating"],"sources":["src/views/user/home/TheaterHome.vue"],"sourcesContent":["<template>\n    <div class=\"card\" style=\"width: 18rem;\">\n        <img src=\"../../../assets/default_theater.jpg\" class=\"card-img-top\" alt=\"Theater image\">\n        <div class=\"card-body\">\n            <h5 class=\"card-title\">{{ theater.theater_name }}</h5>\n            <p class=\"location\"><i class=\"bi bi-geo-alt-fill\" style=\"color:green\"></i>{{ theater.theater_place }}, {{\n                theater.theater_location }}\n            </p>\n            <p style=\"font-size: 12px; margin-top: -15px;\"><i class=\"bi bi-star-fill\" style=\"color: red;\"></i> {{ theater_cal_rating[0,1] }}/5 {{ votes }}\n                Votes</p>\n            <div v-if=\"show_rate_form\">\n            <form class=\"d-flex\" role=\"search\" >\n                <input class=\"form-control me-2\" type=\"number\" placeholder=\"1 to 5\" aria-label=\"Search\"\n                    style=\"width: 60%; height: 30px;\" v-model=\"rate\">\n                <button class=\"btn btn-outline-success\" type=\"button\" style=\"height: 30px; padding-top: 2px;\"\n                    @click=\"rateTheater()\">\n                    <p>Rate<i class=\"bi bi-star\" style=\"color: rgb(235, 183, 183);\"></i></p>\n                </button>\n            </form>\n            </div>\n            <div v-else>\n               You Rated : {{  user_rating }}<i class=\"bi bi-star-fill\" style=\"color: red;\"></i>\n            </div>\n        </div>\n        <ul class=\"list-group list-group-flush\" v-if=\"theater.movies.length > 0\">\n            <li class=\"list-group-item\">Currently Showing</li>\n            <div v-for=\"movie in theater.movies\" :key=\"movie.theater_movie_id\">\n                <li class=\"list-group-item\"><span class=\"movie_name\">{{ movie.movie_name }}<i class=\"movie_tag\">{{\n                    movie.movie_tag }}</i></span>\n                    <span v-show=\"!movie.housefull\"><router-link :to=\"`/movie/booking/${movie.theater_movie_id}`\">\n                            <button type=\"button\" class=\"btn btn-outline-primary\" style=\"\">Book</button>\n                        </router-link></span>\n                    <span v-show=\"movie.housefull\">\n                        <button type=\"button\" class=\"btn btn-outline-danger\" disabled\n                            style=\"font-size: 10px;\">HouseFull</button>\n                    </span>\n                </li>\n            </div>\n        </ul>\n        <ul class=\"list-group list-group-flush\" v-else>\n            <li class=\"list-group-item\">No Show Running</li>\n\n            </ul>\n    </div>\n</template>\n\n\n<script>\nimport axios from 'axios'\nimport refreshAccessToken from '@/utils/refreshToken'\n\nexport default {\n    name: 'TheaterHome',\n    props: ['theater'],\n    data() {\n        return {\n            show_rate_form: false,\n            rate: \"\",\n            user_rating: \"\",\n            votes : \"\",\n            theater_cal_rating: \"\"\n        }\n    },\n    created() {\n        this.theateruserRatings(),\n        this.theaterRatings()\n    },\n    methods: {\n        async theateruserRatings() {\n            try {\n                let access_token = localStorage.getItem('access_token')\n                axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token\n                const theatersRatingResponse = await axios.get(`http://127.0.0.1:8081/api/user/rating/theater/${this.theater.theater_id}`)\n                console.log(theatersRatingResponse)\n                if (theatersRatingResponse.data.status === \"not_rated\") {\n                    this.show_rate_form = true\n                }\n                else {\n                    this.user_rating= theatersRatingResponse.data.rating\n                    this.show_rate_form = false\n                }\n            }\n            catch (error) {\n                if (error.response && error.response.status === 401) {\n                    await refreshAccessToken()\n                    await this.theateruserRatings()\n                }\n\n                else if (error.response) {\n                    console.error(error)\n                    alert('An error occurred while fetching the theater user rating data.')\n                }\n            }\n        },\n        async rateTheater() {\n            if (!this.rate || this.rate > 6 || this.rate < 1) {\n                alert(\"Rate theater between 1 to 5 !!\");\n                return;\n            }\n\n            try {\n                let access_token = localStorage.getItem('access_token')\n\n                axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token\n\n                await axios.post(`http://127.0.0.1:8081/api/user/rating/theater/${this.theater.theater_id}`, {\n                    rating: this.rate,\n                })\n                this.theateruserRatings()\n                this.theaterRatings()\n            }\n            catch (error) {\n                if (error.response && error.response.status === 401) {\n                    await refreshAccessToken();\n                    await this.rateTheater();\n                }\n\n                else if (error.response && error.response.status === 400 || error.response.status === 422) {\n                    this.errors = error.response.data.errors;\n                    alert('An error occurred while creating theater.')\n                }\n            }\n\n        },\n        async theaterRatings() {\n            try {\n                let access_token = localStorage.getItem('access_token')\n\n                axios.defaults.headers.common['Authorization'] = 'Bearer ' + access_token\n                const theatersRatingResponse = await axios.get(`http://127.0.0.1:8081/api/rating/theater/${this.theater.theater_id}`)\n\n                if (theatersRatingResponse.data.votes === 0) {\n                    this.votes = \"-\"\n                    this.theater_cal_rating = \"-\"\n\n                }\n                else {\n                    this.theater_cal_rating = theatersRatingResponse.data.total_rating / theatersRatingResponse.data.votes\n                    this.votes = theatersRatingResponse.data.votes\n                }\n            }\n            catch (error) {\n                if (error.response && error.response.status === 401) {\n                    await refreshAccessToken()\n                    await this.theaterRatings()\n                }\n\n                else if (error.response) {\n                    console.error(error)\n                    alert('An error occurred while fetching the theater user rating data.')\n                }\n            }\n        }\n    }\n}\n\n</script>\n\n<style scoped>\n.location {\n    font-size: small;\n}\n\n.movie_name {\n    font-weight: 700;\n}\n\n.movie_tag {\n    font-weight: 200;\n    font-size: small;\n    margin: 0 20px 0 10px;\n}\n</style>"],"mappings":"AAgDA,OAAAA,KAAA;AACA,OAAAC,kBAAA;AAEA;EACAC,IAAA;EACAC,KAAA;EACAC,KAAA;IACA;MACAC,cAAA;MACAC,IAAA;MACAC,WAAA;MACAC,KAAA;MACAC,kBAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,kBAAA,IACA,KAAAC,cAAA;EACA;EACAC,OAAA;IACA,MAAAF,mBAAA;MACA;QACA,IAAAG,YAAA,GAAAC,YAAA,CAAAC,OAAA;QACAhB,KAAA,CAAAiB,QAAA,CAAAC,OAAA,CAAAC,MAAA,gCAAAL,YAAA;QACA,MAAAM,sBAAA,SAAApB,KAAA,CAAAqB,GAAA,uDAAAC,OAAA,CAAAC,UAAA;QACAC,OAAA,CAAAC,GAAA,CAAAL,sBAAA;QACA,IAAAA,sBAAA,CAAAhB,IAAA,CAAAsB,MAAA;UACA,KAAArB,cAAA;QACA,OACA;UACA,KAAAE,WAAA,GAAAa,sBAAA,CAAAhB,IAAA,CAAAuB,MAAA;UACA,KAAAtB,cAAA;QACA;MACA,EACA,OAAAuB,KAAA;QACA,IAAAA,KAAA,CAAAC,QAAA,IAAAD,KAAA,CAAAC,QAAA,CAAAH,MAAA;UACA,MAAAzB,kBAAA;UACA,WAAAU,kBAAA;QACA,OAEA,IAAAiB,KAAA,CAAAC,QAAA;UACAL,OAAA,CAAAI,KAAA,CAAAA,KAAA;UACAE,KAAA;QACA;MACA;IACA;IACA,MAAAC,YAAA;MACA,UAAAzB,IAAA,SAAAA,IAAA,aAAAA,IAAA;QACAwB,KAAA;QACA;MACA;MAEA;QACA,IAAAhB,YAAA,GAAAC,YAAA,CAAAC,OAAA;QAEAhB,KAAA,CAAAiB,QAAA,CAAAC,OAAA,CAAAC,MAAA,gCAAAL,YAAA;QAEA,MAAAd,KAAA,CAAAgC,IAAA,uDAAAV,OAAA,CAAAC,UAAA;UACAI,MAAA,OAAArB;QACA;QACA,KAAAK,kBAAA;QACA,KAAAC,cAAA;MACA,EACA,OAAAgB,KAAA;QACA,IAAAA,KAAA,CAAAC,QAAA,IAAAD,KAAA,CAAAC,QAAA,CAAAH,MAAA;UACA,MAAAzB,kBAAA;UACA,WAAA8B,WAAA;QACA,OAEA,IAAAH,KAAA,CAAAC,QAAA,IAAAD,KAAA,CAAAC,QAAA,CAAAH,MAAA,YAAAE,KAAA,CAAAC,QAAA,CAAAH,MAAA;UACA,KAAAO,MAAA,GAAAL,KAAA,CAAAC,QAAA,CAAAzB,IAAA,CAAA6B,MAAA;UACAH,KAAA;QACA;MACA;IAEA;IACA,MAAAlB,eAAA;MACA;QACA,IAAAE,YAAA,GAAAC,YAAA,CAAAC,OAAA;QAEAhB,KAAA,CAAAiB,QAAA,CAAAC,OAAA,CAAAC,MAAA,gCAAAL,YAAA;QACA,MAAAM,sBAAA,SAAApB,KAAA,CAAAqB,GAAA,kDAAAC,OAAA,CAAAC,UAAA;QAEA,IAAAH,sBAAA,CAAAhB,IAAA,CAAAI,KAAA;UACA,KAAAA,KAAA;UACA,KAAAC,kBAAA;QAEA,OACA;UACA,KAAAA,kBAAA,GAAAW,sBAAA,CAAAhB,IAAA,CAAA8B,YAAA,GAAAd,sBAAA,CAAAhB,IAAA,CAAAI,KAAA;UACA,KAAAA,KAAA,GAAAY,sBAAA,CAAAhB,IAAA,CAAAI,KAAA;QACA;MACA,EACA,OAAAoB,KAAA;QACA,IAAAA,KAAA,CAAAC,QAAA,IAAAD,KAAA,CAAAC,QAAA,CAAAH,MAAA;UACA,MAAAzB,kBAAA;UACA,WAAAW,cAAA;QACA,OAEA,IAAAgB,KAAA,CAAAC,QAAA;UACAL,OAAA,CAAAI,KAAA,CAAAA,KAAA;UACAE,KAAA;QACA;MACA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}